<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAMStix.id - Pemesanan Tiket Online</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- PWA Metadata -->
    <meta name="theme-color" content="#3A7BCE">
    <meta name="description" content="BAMStix.id - Aplikasi pemesanan tiket online untuk konser, olahraga, seminar, dan kesenian">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ«</text></svg>">
    
    <style>
        :root {
            --primary: #3A7BCE;
            --primary-dark: #2c6ab8;
            --white: #FFFFFF;
            --black: #1E1E1E;
            --dark-grey: #333333;
            --light-grey: #F2F5FA;
            --soft-blue: #E8EEF7;
            --success: #2ECC71;
            --warning: #F1C40F;
            --danger: #E74C3C;
            --card-radius: 16px;
            --btn-radius: 12px;
            --transition: all 0.3s ease;
        }

        [data-theme="purple"] {
            --primary: #8A2BE2;
            --primary-dark: #7a1ad1;
        }

        [data-theme="orange"] {
            --primary: #FF6B35;
            --primary-dark: #e55a2c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--light-grey);
            color: var(--dark-grey);
            transition: var(--transition);
            padding-top: 56px;
            padding-bottom: 70px;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .navbar {
            background-color: var(--white) !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .navbar-brand {
            font-weight: 800;
            color: var(--primary) !important;
            font-size: 1.5rem;
        }

        .nav-link {
            color: var(--dark-grey) !important;
        }

        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
            border-radius: var(--btn-radius);
            padding: 10px 20px;
            font-weight: 600;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        .card {
            border: none;
            border-radius: var(--card-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            background-color: var(--white);
            margin-bottom: 1rem;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .card-img-top {
            border-top-left-radius: var(--card-radius);
            border-top-right-radius: var(--card-radius);
            height: 180px;
            object-fit: cover;
            cursor: pointer;
            transition: var(--transition);
        }

        .card-img-top:hover {
            opacity: 0.9;
        }

        .event-category {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .price-tag {
            font-weight: 800;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .icon-bar {
            display: flex;
            justify-content: space-around;
            background-color: var(--white);
            padding: 15px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 999;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }

        .icon-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #9AA5B1;
            text-decoration: none;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .icon-item.active, .icon-item:hover {
            color: var(--primary);
        }

        .icon-item i {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .search-bar {
            background-color: #F5F7FA;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            width: 100%;
        }

        .carousel-item img {
            height: 200px;
            object-fit: cover;
            border-radius: var(--card-radius);
        }

        .carousel-indicators button {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #D1D1D1 !important;
            border: none;
            margin: 0 3px;
        }

        .carousel-indicators button.active {
            background-color: var(--primary) !important;
        }

        .toast {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 1100;
            border-radius: var(--btn-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .toast-success {
            background-color: var(--success);
            color: white;
        }

        .toast-info {
            background-color: var(--primary);
            color: white;
        }

        .toast-warning {
            background-color: var(--warning);
            color: black;
        }

        .toast-danger {
            background-color: var(--danger);
            color: white;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--white);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.5s ease;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal-image {
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-image:hover {
            transform: scale(1.02);
        }

        .modal-fullscreen-img {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 10px;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        .ticket-used {
            filter: grayscale(100%);
            opacity: 0.7;
        }

        .theme-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .theme-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .theme-option.active {
            border-color: var(--dark-grey);
        }

        .theme-default {
            background-color: #3A7BCE;
        }

        .theme-purple {
            background-color: #8A2BE2;
        }

        .theme-orange {
            background-color: #FF6B35;
        }

        .badge-trending {
            background-color: var(--warning);
            color: black;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .countdown-timer {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            margin: 20px 0;
        }

        .profile-pic {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            cursor: pointer;
        }

        .profile-pic-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Sidebar Navigation Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: -320px;
            width: 300px;
            height: 100%;
            background-color: var(--white);
            z-index: 1050;
            transition: left 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
            padding-top: 70px;
            overflow-y: auto;
        }

        .sidebar.show {
            left: 0;
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1040;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .sidebar-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-content {
            padding: 0 20px 20px 20px;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link-sidebar {
            display: flex;
            align-items: center;
            padding: 14px 15px;
            color: var(--dark-grey);
            text-decoration: none;
            border-radius: 10px;
            transition: var(--transition);
            font-weight: 500;
        }

        .nav-link-sidebar:hover {
            background-color: var(--soft-blue);
            color: var(--primary);
        }

        .nav-link-sidebar.active {
            background-color: var(--primary);
            color: white;
        }

        .nav-link-sidebar i {
            margin-right: 12px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--black);
            font-weight: 700;
        }

        h1 {
            font-size: 24px;
        }

        h2 {
            font-size: 20px;
        }

        .event-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--black);
        }

        .normal-text {
            font-size: 14px;
        }

        .small-text {
            font-size: 12px;
            color: #666;
        }

        .section-title {
            margin: 20px 0 15px 0;
            font-weight: 700;
            color: var(--black);
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-item-controls button {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--light-grey);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-total {
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .payment-method {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method:hover {
            border-color: var(--primary);
            background-color: var(--soft-blue);
        }

        .payment-method.selected {
            border-color: var(--primary);
            background-color: var(--soft-blue);
        }

        .ticket-card {
            border-left: 5px solid var(--primary);
            transition: var(--transition);
        }

        .ticket-card:hover {
            transform: translateX(5px);
        }

        .ticket-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-valid {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }

        .status-used {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--danger);
        }

        .status-pending {
            background-color: rgba(241, 196, 15, 0.2);
            color: #b7950b;
        }

        .event-detail-poster {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: var(--card-radius);
            cursor: pointer;
        }

        .bookmark-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #ccc;
            transition: var(--transition);
        }

        .bookmark-btn.active {
            color: var(--warning);
        }

        .bookmark-btn:hover {
            background-color: white;
            color: var(--warning);
        }

        /* Floating Action Button (FAB) - Fixed z-index issue */
        .fab {
            position: fixed;
            bottom: 90px; /* Increased from 80px to avoid overlap with bottom nav */
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: #25D366;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
            z-index: 998; /* Reduced from 999 to be below bottom nav */
            cursor: pointer;
            transition: var(--transition);
            animation: pulse 2s infinite;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }

        .fab i {
            color: white;
            font-size: 28px;
        }

        @keyframes pulse {
            0% { box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(37, 211, 102, 0.5); }
            100% { box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3); }
        }

        /* Riwayat Pembelian Tiket Section */
        .purchase-history-section {
            margin: 20px 0;
        }

        .purchase-history-card {
            border-radius: var(--card-radius);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            background-color: var(--white);
            padding: 20px;
        }

        .purchase-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .purchase-history-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--black);
            margin: 0;
        }

        .view-all-link {
            color: var(--primary);
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .view-all-link:hover {
            text-decoration: underline;
        }

        .purchase-history-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .purchase-qr-placeholder {
            width: 100px;
            height: 100px;
            background-color: #f8f9fa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #dee2e6;
        }

        .purchase-qr-placeholder i {
            font-size: 40px;
            color: #adb5bd;
        }

        .purchase-details {
            flex: 1;
        }

        .purchase-event-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: 8px;
        }

        .purchase-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 12px;
        }

        .purchase-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #666;
        }

        .purchase-meta-item i {
            font-size: 14px;
        }

        .purchase-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background-color: rgba(46, 204, 113, 0.15);
            color: var(--success);
        }

        .no-purchase-history {
            text-align: center;
            padding: 30px 20px;
            color: #666;
        }

        .no-purchase-history i {
            font-size: 40px;
            margin-bottom: 15px;
            color: #dee2e6;
        }

        .no-purchase-history p {
            margin: 0;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .sidebar {
                width: 280px;
                left: -280px;
            }
            
            .purchase-history-content {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .purchase-qr-placeholder {
                align-self: center;
            }
            
            .fab {
                bottom: 80px; /* Adjusted for mobile */
                right: 15px;
                width: 56px;
                height: 56px;
            }
            
            .fab i {
                font-size: 24px;
            }
        }

        @media (max-width: 480px) {
            .purchase-meta {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer"></div>

    <!-- Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- Sidebar Navigation -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-content">
            <!-- Search Bar in Sidebar -->
            <div class="mb-4">
                <input type="text" class="form-control search-bar" id="sidebarSearch" placeholder="Cari event...">
                <div id="sidebarSearchResults" class="mt-2" style="display: none;">
                    <div class="list-group" id="searchResultsList">
                        <!-- Search results will be dynamically inserted here -->
                    </div>
                </div>
            </div>
            
            <!-- Navigation Menu -->
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link-sidebar active" data-page="homePage">
                        <i class="bi bi-house-door"></i>
                        <span>Beranda</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link-sidebar" data-page="categoryPage" data-category="konser">
                        <i class="bi bi-music-note-beamed"></i>
                        <span>Konser</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link-sidebar" data-page="categoryPage" data-category="olahraga">
                        <i class="bi bi-trophy"></i>
                        <span>Olahraga</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link-sidebar" data-page="categoryPage" data-category="seminar">
                        <i class="bi bi-mic"></i>
                        <span>Seminar</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link-sidebar" data-page="categoryPage" data-category="kesenian">
                        <i class="bi bi-palette"></i>
                        <span>Kesenian</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link-sidebar" data-page="myTicketsPage">
                        <i class="bi bi-ticket"></i>
                        <span>Tiket Saya</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link-sidebar" data-page="profilePage">
                        <i class="bi bi-person"></i>
                        <span>Profil Saya</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="https://wa.me/6285945365017" class="nav-link-sidebar" target="_blank">
                        <i class="bi bi-whatsapp"></i>
                        <span>Customer Support</span>
                    </a>
                </li>
            </ul>
            
            <!-- Theme Selector -->
            <div class="mt-5">
                <h6 class="mb-3">Tema Aplikasi</h6>
                <div class="theme-selector">
                    <div class="theme-option theme-default active" data-theme="default" title="Default Blue"></div>
                    <div class="theme-option theme-purple" data-theme="purple" title="Purple Neon"></div>
                    <div class="theme-option theme-orange" data-theme="orange" title="Orange Modern"></div>
                </div>
            </div>
            
            <!-- App Info -->
            <div class="mt-5 pt-4 border-top text-center">
                <p class="small-text text-muted mb-0">BAMStix.id v2.0</p>
                <p class="small-text text-muted">Â© 2026 All rights reserved</p>
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <button class="navbar-toggler me-2" type="button" id="menuButton">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="#">
                <i class="bi bi-ticket-perforated me-1"></i> BAMStix.id
            </a>
            
            <div class="d-flex align-items-center">
                <div class="position-relative me-3">
                    <a href="#" class="nav-link" id="cartButton">
                        <i class="bi bi-cart3"></i>
                        <span id="cartBadge" class="cart-badge">0</span>
                    </a>
                </div>
                <div class="dropdown">
                    <a href="#" class="nav-link" id="profileDropdown" data-bs-toggle="dropdown">
                        <img id="profilePic" src="https://ui-avatars.com/api/?name=Pengguna&background=3A7BCE&color=fff" 
                             alt="Profile" class="profile-pic-small">
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#" id="profileBtn"><i class="bi bi-person me-2"></i>Profil</a></li>
                        <li><a class="dropdown-item" href="#" id="myTicketsBtn"><i class="bi bi-ticket me-2"></i>Tiket Saya</a></li>
                        <li><a class="dropdown-item" href="#" id="bookmarksBtn"><i class="bi bi-bookmark me-2"></i>Bookmark</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Floating Action Button (WhatsApp) -->
    <a href="https://wa.me/6285945365017" class="fab" target="_blank">
        <i class="bi bi-whatsapp"></i>
    </a>

    <!-- Main Pages Container -->
    <div class="container mt-3" id="mainContent">
        <!-- Home Page -->
        <div id="homePage" class="page active">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4>Event Trending</h4>
                <button class="btn btn-sm btn-outline-primary" id="viewAllBtn">Lihat Semua</button>
            </div>
            
            <!-- Carousel/Slider -->
            <div id="eventCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#eventCarousel" data-bs-slide-to="0" class="active"></button>
                    <button type="button" data-bs-target="#eventCarousel" data-bs-slide-to="1"></button>
                    <button type="button" data-bs-target="#eventCarousel" data-bs-slide-to="2"></button>
                    <button type="button" data-bs-target="#eventCarousel" data-bs-slide-to="3"></button>
                </div>
                <div class="carousel-inner">
                    <!-- Carousel items will be dynamically inserted here -->
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#eventCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#eventCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
            
            <!-- Riwayat Terakhir Pembelian Tiket Section -->
            <div class="purchase-history-section">
                <div class="purchase-history-card">
                    <div class="purchase-history-header">
                        <h5 class="purchase-history-title">Riwayat Terakhir Pembelian Tiket</h5>
                        <a href="#" class="view-all-link" id="viewAllHistoryBtn">
                            <span>Lihat Semua</span>
                            <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                    
                    <div id="purchaseHistoryContent">
                        <!-- Purchase history will be dynamically inserted here -->
                        <div class="no-purchase-history" id="noPurchaseHistory">
                            <i class="bi bi-receipt"></i>
                            <p>Belum ada riwayat pembelian tiket</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div class="mb-4">
                <div class="input-group">
                    <input type="text" class="form-control search-bar" id="mainSearch" placeholder="Cari event berdasarkan judul, kategori, atau lokasi...">
                    <button class="btn btn-primary" type="button" id="searchButton">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
                <div class="mt-2" id="popularTags">
                    <small class="text-muted me-2">Tag populer:</small>
                    <span class="badge bg-light text-dark me-1 tag-filter" data-tag="gratis">Gratis</span>
                    <span class="badge bg-light text-dark me-1 tag-filter" data-tag="trending">Trending</span>
                    <span class="badge bg-light text-dark me-1 tag-filter" data-tag="olahraga">Olahraga</span>
                    <span class="badge bg-light text-dark me-1 tag-filter" data-tag="konser">Konser</span>
                </div>
            </div>
            
            <!-- Filter & Sort -->
            <div class="d-flex justify-content-between mb-3">
                <div class="dropdown">
                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown">
                        <i class="bi bi-funnel me-1"></i> Filter
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item filter-option" href="#" data-filter="all">Semua</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="olahraga">Olahraga</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="konser">Konser</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="seminar">Seminar</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="kesenian">Kesenian</a></li>
                    </ul>
                </div>
                
                <div class="dropdown">
                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown">
                        <i class="bi bi-sort-down me-1"></i> Urutkan
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item sort-option" href="#" data-sort="date-asc">Tanggal Terdekat</a></li>
                        <li><a class="dropdown-item sort-option" href="#" data-sort="price-asc">Harga Termurah</a></li>
                        <li><a class="dropdown-item sort-option" href="#" data-sort="price-desc">Harga Termahal</a></li>
                        <li><a class="dropdown-item sort-option" href="#" data-sort="popular">Paling Populer</a></li>
                    </ul>
                </div>
            </div>
            
            <!-- Events List -->
            <h5 class="section-title">Event Terbaru</h5>
            <div id="eventsList" class="row">
                <!-- Events will be dynamically inserted here -->
            </div>
        </div>

        <!-- Category Page -->
        <div id="categoryPage" class="page">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-sm btn-outline-secondary" id="backFromCategory">
                    <i class="bi bi-arrow-left me-1"></i>Kembali
                </button>
                <h4 id="categoryTitle">Kategori</h4>
                <div></div> <!-- Empty div for alignment -->
            </div>
            
            <div id="categoryEventsList" class="row">
                <!-- Category events will be dynamically inserted here -->
            </div>
        </div>

        <!-- Event Detail Page -->
        <div id="eventDetailPage" class="page">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-sm btn-outline-secondary" id="backFromDetail">
                    <i class="bi bi-arrow-left me-1"></i>Kembali
                </button>
                <h4>Detail Event</h4>
                <div></div> <!-- Empty div for alignment -->
            </div>
            
            <div id="eventDetailContent">
                <!-- Event detail will be dynamically inserted here -->
            </div>
        </div>

        <!-- Cart Page -->
        <div id="cartPage" class="page">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-sm btn-outline-secondary" id="backFromCart">
                    <i class="bi bi-arrow-left me-1"></i>Kembali
                </button>
                <h4>Keranjang Tiket</h4>
                <button class="btn btn-sm btn-danger" id="clearCartBtn">
                    <i class="bi bi-trash me-1"></i>Kosongkan
                </button>
            </div>
            
            <div id="cartItemsList">
                <!-- Cart items will be dynamically inserted here -->
            </div>
            
            <div class="card mt-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Total Pembayaran</h5>
                        <h4 class="mb-0 cart-total" id="cartTotal">Rp 0</h4>
                    </div>
                    <button class="btn btn-primary w-100 mt-3" id="checkoutBtn">
                        <i class="bi bi-credit-card me-2"></i>Lanjut ke Pembayaran
                    </button>
                </div>
            </div>
        </div>

        <!-- Checkout Page -->
        <div id="checkoutPage" class="page">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-sm btn-outline-secondary" id="backFromCheckout">
                    <i class="bi bi-arrow-left me-1"></i>Kembali
                </button>
                <h4>Checkout</h4>
                <div></div> <!-- Empty div for alignment -->
            </div>
            
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="mb-3">Data Diri</h5>
                    <div class="mb-3">
                        <label for="fullName" class="form-label">Nama Lengkap</label>
                        <input type="text" class="form-control" id="fullName" placeholder="Masukkan nama lengkap">
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" placeholder="nama@email.com">
                    </div>
                    <div class="mb-3">
                        <label for="phone" class="form-label">Nomor Telepon</label>
                        <input type="tel" class="form-control" id="phone" placeholder="081234567890">
                    </div>
                </div>
            </div>
            
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="mb-3">Metode Pembayaran</h5>
                    <div class="payment-method selected" data-method="qris">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="qris" checked>
                            <label class="form-check-label" for="qris">
                                <strong>QRIS</strong>
                                <p class="small-text mb-0">Scan QR code untuk pembayaran</p>
                            </label>
                        </div>
                    </div>
                    <div class="payment-method" data-method="bank">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="bank">
                            <label class="form-check-label" for="bank">
                                <strong>Transfer Bank</strong>
                                <p class="small-text mb-0">Transfer ke rekening BAMStix</p>
                            </label>
                        </div>
                    </div>
                    <div class="payment-method" data-method="ewallet">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="ewallet">
                            <label class="form-check-label" for="ewallet">
                                <strong>E-Wallet</strong>
                                <p class="small-text mb-0">Gopay, OVO, Dana, LinkAja</p>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="mb-3">Ringkasan Pesanan</h5>
                    <div id="orderSummary">
                        <!-- Order summary will be dynamically inserted here -->
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between">
                        <h5>Total</h5>
                        <h4 class="cart-total" id="checkoutTotal">Rp 0</h4>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary w-100 mb-3" id="confirmPaymentBtn">
                <i class="bi bi-check-circle me-2"></i>Bayar Sekarang
            </button>
        </div>

        <!-- Payment QR Page -->
        <div id="paymentQrPage" class="page">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-sm btn-outline-secondary" id="backFromPayment">
                    <i class="bi bi-arrow-left me-1"></i>Kembali
                </button>
                <h4>Pembayaran</h4>
                <div></div> <!-- Empty div for alignment -->
            </div>
            
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="mb-3">Scan QR Code untuk Pembayaran</h5>
                    <div class="qr-code" id="paymentQrCode">
                        <!-- QR Code will be dynamically generated here -->
                        <div class="text-center">
                            <i class="bi bi-qr-code" style="font-size: 3rem; color: #ccc;"></i>
                            <p class="small-text mt-2">QR Code akan muncul</p>
                        </div>
                    </div>
                    <p class="mt-3">Gunakan aplikasi pembayaran untuk scan QR code di atas</p>
                    
                    <div class="countdown-timer" id="countdownTimer">15:00</div>
                    <p class="small-text text-muted">Batas waktu pembayaran</p>
                    
                    <div class="mt-4">
                        <button class="btn btn-success me-2" id="completePaymentBtn">
                            <i class="bi bi-check-lg me-1"></i>Pembayaran Selesai
                        </button>
                        <button class="btn btn-outline-danger" id="cancelPaymentBtn">
                            <i class="bi bi-x-lg me-1"></i>Batalkan
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Success Page -->
        <div id="paymentSuccessPage" class="page">
            <div class="text-center py-5">
                <div class="mb-4">
                    <i class="bi bi-check-circle" style="font-size: 5rem; color: var(--success);"></i>
                </div>
                <h2 class="mb-3" style="color: var(--success);">PEMBAYARAN BERHASIL!</h2>
                <p class="mb-4">Tiket Anda telah berhasil dipesan. Tiket dapat dilihat di halaman "Tiket Saya".</p>
                <div class="qr-code mx-auto mb-4">
                    <!-- Success QR Code will be dynamically generated here -->
                    <div class="text-center">
                        <i class="bi bi-qr-code" style="font-size: 3rem; color: #ccc;"></i>
                    </div>
                </div>
                <p class="small-text">Tunjukkan QR Code ini di lokasi event</p>
                
                <div class="mt-5">
                    <button class="btn btn-primary me-2" id="viewTicketBtn">
                        <i class="bi bi-ticket me-1"></i>Lihat Tiket
                    </button>
                    <button class="btn btn-outline-secondary" id="backToHomeFromSuccess">
                        <i class="bi bi-house me-1"></i>Kembali ke Beranda
                    </button>
                </div>
            </div>
        </div>

        <!-- My Tickets Page -->
        <div id="myTicketsPage" class="page">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-sm btn-outline-secondary" id="backFromTickets">
                    <i class="bi bi-arrow-left me-1"></i>Kembali
                </button>
                <h4>Tiket Saya</h4>
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="ticketFilterDropdown" data-bs-toggle="dropdown">
                        Filter
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item ticket-filter" href="#" data-status="all">Semua Tiket</a></li>
                        <li><a class="dropdown-item ticket-filter" href="#" data-status="active">Tiket Aktif</a></li>
                        <li><a class="dropdown-item ticket-filter" href="#" data-status="used">Sudah Digunakan</a></li>
                        <li><a class="dropdown-item ticket-filter" href="#" data-status="expired">Kadaluarsa</a></li>
                        <li><a class="dropdown-item ticket-filter" href="#" data-status="resell">Untuk Dijual</a></li>
                    </ul>
                </div>
            </div>
            
            <div id="ticketsList">
                <!-- User's tickets will be dynamically inserted here -->
                <div class="text-center py-5" id="noTicketsMessage">
                    <i class="bi bi-ticket" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                    <p>Anda belum memiliki tiket</p>
                    <a href="#" class="btn btn-primary" id="browseEventsFromTickets">Jelajahi Event</a>
                </div>
            </div>
        </div>

        <!-- Ticket Detail Page -->
        <div id="ticketDetailPage" class="page">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-sm btn-outline-secondary" id="backFromTicketDetail">
                    <i class="bi bi-arrow-left me-1"></i>Kembali
                </button>
                <h4>Detail Tiket</h4>
                <div></div> <!-- Empty div for alignment -->
            </div>
            
            <div id="ticketDetailContent">
                <!-- Ticket detail will be dynamically inserted here -->
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profilePage" class="page">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-sm btn-outline-secondary" id="backFromProfile">
                    <i class="bi bi-arrow-left me-1"></i>Kembali
                </button>
                <h4>Profil Saya</h4>
                <div></div> <!-- Empty div for alignment -->
            </div>
            
            <div class="card text-center mb-3">
                <div class="card-body">
                    <div class="mb-3">
                        <img id="profilePicture" src="https://ui-avatars.com/api/?name=Pengguna&background=3A7BCE&color=fff" 
                             alt="Profile" class="profile-pic mb-2">
                    </div>
                    <input type="file" id="profilePictureInput" accept="image/*" style="display: none;">
                    <button class="btn btn-outline-primary btn-sm" id="changeProfilePicBtn">
                        <i class="bi bi-camera me-1"></i>Ubah Foto Profil
                    </button>
                    <h5 class="mt-3" id="profileName">Pengguna BAMStix</h5>
                    <p class="small-text text-muted" id="profileEmail">pengguna@bamstix.id</p>
                </div>
            </div>
            
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="mb-3">Informasi Profil</h5>
                    <div class="mb-3">
                        <label for="profileFullName" class="form-label">Nama Lengkap</label>
                        <input type="text" class="form-control" id="profileFullName" value="Pengguna BAMStix">
                    </div>
                    <div class="mb-3">
                        <label for="profileEmailInput" class="form-label">Email</label>
                        <input type="email" class="form-control" id="profileEmailInput" value="pengguna@bamstix.id">
                    </div>
                    <div class="mb-3">
                        <label for="profilePhone" class="form-label">Nomor Telepon</label>
                        <input type="tel" class="form-control" id="profilePhone" value="081234567890">
                    </div>
                    <button class="btn btn-primary w-100" id="saveProfileBtn">
                        <i class="bi bi-save me-1"></i>Simpan Perubahan
                    </button>
                </div>
            </div>
            
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="mb-3">Statistik Saya</h5>
                    <div class="row text-center">
                        <div class="col-4">
                            <h5 id="totalTickets">0</h5>
                            <p class="small-text mb-0">Total Tiket</p>
                        </div>
                        <div class="col-4">
                            <h5 id="activeTickets">0</h5>
                            <p class="small-text mb-0">Tiket Aktif</p>
                        </div>
                        <div class="col-4">
                            <h5 id="bookmarkedEvents">0</h5>
                            <p class="small-text mb-0">Bookmark</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bookmarks Page -->
        <div id="bookmarksPage" class="page">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-sm btn-outline-secondary" id="backFromBookmarks">
                    <i class="bi bi-arrow-left me-1"></i>Kembali
                </button>
                <h4>Event Disimpan</h4>
                <button class="btn btn-sm btn-outline-danger" id="clearBookmarksBtn">
                    <i class="bi bi-trash me-1"></i>Hapus Semua
                </button>
            </div>
            
            <div id="bookmarksList" class="row">
                <!-- Bookmarked events will be dynamically inserted here -->
                <div class="text-center py-5" id="noBookmarksMessage">
                    <i class="bi bi-bookmark" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                    <p>Belum ada event yang disimpan</p>
                    <a href="#" class="btn btn-primary" id="browseEventsFromBookmarks">Jelajahi Event</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modalImage" src="" alt="Event Image" class="modal-fullscreen-img">
                </div>
            </div>
        </div>
    </div>

    <!-- Icon Navigation Bar (Bottom) -->
    <div class="icon-bar">
        <a href="#" class="icon-item active" data-page="homePage">
            <i class="bi bi-house-door"></i>
            <span>Beranda</span>
        </a>
        <a href="#" class="icon-item" data-page="categoryPage" data-category="all">
            <i class="bi bi-grid"></i>
            <span>Kategori</span>
        </a>
        <a href="#" class="icon-item" data-page="myTicketsPage">
            <i class="bi bi-ticket"></i>
            <span>Tiket Saya</span>
        </a>
        <a href="#" class="icon-item" data-page="profilePage">
            <i class="bi bi-person"></i>
            <span>Profil</span>
        </a>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- QR Code Generator Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script>
        // Initial Data for Events (Based on provided data)
        const initialEvents = [
            // Olahraga events
            {
                id: 1,
                name: "BFI Run 2025",
                category: "olahraga",
                date: "2025-05-18",
                time: "06:00",
                location: "Jakarta",
                price: 750000,
                description: "Lari marathon dengan kategori Half Marathon. Tiket sudah sold out untuk kategori ini.",
                image: "img/olahraga11.jpg",
                capacity: 1000,
                trending: true
            },
            {
                id: 2,
                name: "IFCPF 2025 Asia-Oceania Cup (Semi-Final)",
                category: "olahraga",
                date: "2025-11-20",
                time: "15:00",
                location: "Jakarta International Stadium",
                price: 0,
                description: "Turnamen sepak bola untuk penyandang disabilitas cerebral palsy. Terbuka untuk umum.",
                image: "img/olahraga2.jpg",
                capacity: 5000,
                trending: false
            },
            {
                id: 3,
                name: "MR D.I.Y. Run 2025",
                category: "olahraga",
                date: "2025-02-23",
                time: "06:30",
                location: "Surabaya",
                price: 200000,
                description: "Fun run dengan berbagai kategori jarak. Cocok untuk pelari pemula hingga profesional.",
                image: "img/olahraga13.jpg",
                capacity: 3000,
                trending: true
            },
            {
                id: 4,
                name: "Road to Bekasi Marathon 2025 (5K Fun Run)",
                category: "olahraga",
                date: "2024-11-24",
                time: "06:00",
                location: "Bekasi",
                price: 25000,
                description: "Fun run 5K sebagai bagian dari persiapan Bekasi Marathon 2025.",
                image: "img/olahraga11.jpg",
                capacity: 2000,
                trending: false
            },
            {
                id: 5,
                name: "Binloop Ultra 120 (Simply Sixth)",
                category: "olahraga",
                date: "2023-05-05",
                time: "04:00",
                location: "Bandung",
                price: 1500000,
                description: "Ultra marathon dengan kategori 200K untuk pelari berpengalaman.",
                image: "img/olahraga17.jpg",
                capacity: 500,
                trending: false
            },
            {
                id: 6,
                name: "Women's Day Run 10K (WDR) 2025",
                category: "olahraga",
                date: "2025-05-04",
                time: "06:00",
                location: "Jakarta",
                price: 300000,
                description: "Lari 10K untuk merayakan Hari Perempuan Internasional.",
                image: "img/olahraga12.jpg",
                capacity: 2000,
                trending: true
            },
            {
                id: 7,
                name: "Zombie Run Festival",
                category: "olahraga",
                date: "2025-02-22",
                time: "18:00",
                location: "Yogyakarta",
                price: 350000,
                description: "Lari dengan tema zombie di malam hari. Pengalaman unik dan menegangkan.",
                image: "img/olahraga14.jpg",
                capacity: 1500,
                trending: true
            },
            {
                id: 8,
                name: "Persis Solo vs PSIM (Derby Mataram)",
                category: "olahraga",
                date: "2025-11-08",
                time: "19:30",
                location: "Solo",
                price: 250000,
                description: "Pertandingan sepak bola Derby Mataram antara Persis Solo vs PSIM.",
                image: "img/olahraga1.jpg",
                capacity: 20000,
                trending: true
            },
            {
                id: 9,
                name: "Indonesia vs Thailand Badminton",
                category: "olahraga",
                date: "2025-01-08",
                time: "18:00",
                location: "Istora Senayan, Jakarta",
                price: 200000,
                description: "Pertandingan bulutangkis antara Indonesia vs Thailand.",
                image: "img/olahraga2.jpg",
                capacity: 8000,
                trending: true
            },
            {
                id: 10,
                name: "Persija Vs Psim",
                category: "olahraga",
                date: "2025-11-08",
                time: "19:30",
                location: "Jakarta",
                price: 250000,
                description: "Pertandingan sepak bola antara Persija vs PSIM.",
                image: "img/persija.jpg",
                capacity: 25000,
                trending: true
            },
            
            // Konser events
            {
                id: 11,
                name: "Two Stroke Party 4th Annual 2025",
                category: "konser",
                date: "2025-12-07",
                time: "20:00",
                location: "Jakarta",
                price: 0,
                description: "Pesta musik tahunan dengan berbagai penampilan artis.",
                image: "img/music6.jpg",
                capacity: 5000,
                trending: false
            },
            {
                id: 12,
                name: "Gigs Eksplosif",
                category: "konser",
                date: "2025-11-19",
                time: "19:00",
                location: "Bandung",
                price: 50000,
                description: "Konser musik indie dengan berbagai band lokal.",
                image: "img/music4.jpg",
                capacity: 1000,
                trending: true
            },
            {
                id: 13,
                name: "Lollipop Fest Vol. 1",
                category: "konser",
                date: "2026-02-08",
                time: "18:00",
                location: "Surabaya",
                price: 94500,
                description: "Festival musik dengan berbagai genre dan artis ternama.",
                image: "img/music5.jpg",
                capacity: 3000,
                trending: true
            },
            {
                id: 14,
                name: "Sarga Festival (Food & Music)",
                category: "konser",
                date: "2025-04-20",
                time: "16:00",
                location: "Yogyakarta",
                price: 25000,
                description: "Festival makanan dan musik dengan suasana santai.",
                image: "img/music10.jpg",
                capacity: 2000,
                trending: false
            },
            {
                id: 15,
                name: "Hadir Fest Vol. 1",
                category: "konser",
                date: "2025-11-15",
                time: "18:00",
                location: "Jakarta",
                price: 75000,
                description: "Festival musik dengan penampilan berbagai artis lokal.",
                image: "img/music2.jpg",
                capacity: 1500,
                trending: true
            },
            {
                id: 16,
                name: "Royal Surakarta Wellness Festival",
                category: "konser",
                date: "2025-11-01",
                time: "09:00",
                location: "Solo",
                price: 1500000,
                description: "Festival kesehatan dan musik dengan berbagai aktivitas wellness.",
                image: "img/music1.jpg",
                capacity: 1000,
                trending: false
            },
            {
                id: 17,
                name: "Hadir Fest Vol. 1 & Lokananta",
                category: "konser",
                date: "2025-11-15",
                time: "18:00",
                location: "Solo",
                price: 75000,
                description: "Kolaborasi festival musik dengan studio rekaman Lokananta.",
                image: "img/music2.jpg",
                capacity: 1200,
                trending: true
            },
            {
                id: 18,
                name: "Maroon 5 Asia 2025 - Jakarta",
                category: "konser",
                date: "2025-02-01",
                time: "20:00",
                location: "Jakarta International Stadium",
                price: 6000000,
                description: "Konser internasional Maroon 5 di Jakarta.",
                image: "img/music8.jpg",
                capacity: 30000,
                trending: true
            },
            {
                id: 19,
                name: "ArjunaFest Vol. 5",
                category: "konser",
                date: "2025-12-06",
                time: "17:00",
                location: "Malang",
                price: 35000,
                description: "Festival musik kampus tahunan dengan berbagai penampilan.",
                image: "img/RAN.jpg",
                capacity: 2000,
                trending: true
            },
            {
                id: 20,
                name: "International Golo Mori Jazz 2025",
                category: "konser",
                date: "2025-04-12",
                time: "19:00",
                location: "Jakarta",
                price: 6500000,
                description: "Festival jazz internasional dengan musisi jazz dunia.",
                image: "img/music13.jpg",
                capacity: 1500,
                trending: true
            },
            
            // Kesenian events
            {
                id: 21,
                name: "Pementasan Seni 'Merajut Cerita Menyatukan Rasa'",
                category: "kesenian",
                date: "2025-10-26",
                time: "19:00",
                location: "Jakarta",
                price: 0,
                description: "Pertunjukan seni yang mengangkat cerita-cerita lokal.",
                image: "img/kesenian1.jpg",
                capacity: 800,
                trending: false
            },
            {
                id: 22,
                name: "Begawi Budaya Dewan Kesenian Metro",
                category: "kesenian",
                date: "2025-11-15",
                time: "18:00",
                location: "Metro, Lampung",
                price: 0,
                description: "Pagelaran budaya yang menampilkan berbagai kesenian tradisional.",
                image: "img/kesenian2.jpg",
                capacity: 1000,
                trending: false
            },
            {
                id: 23,
                name: "Festival Teater Indonesia 2025",
                category: "kesenian",
                date: "2025-12-06",
                time: "19:00",
                location: "Jakarta",
                price: 0,
                description: "Festival teater terbesar di Indonesia dengan berbagai kelompok teater.",
                image: "img/kesenian3.jpg",
                capacity: 1500,
                trending: true
            },
            {
                id: 24,
                name: "Pertunjukan Seni Gambang Semarang",
                category: "kesenian",
                date: "2025-11-23",
                time: "19:30",
                location: "Semarang",
                price: 0,
                description: "Pertunjukan musik tradisional Gambang Semarang.",
                image: "img/kesenian4.jpg",
                capacity: 600,
                trending: false
            },
            {
                id: 25,
                name: "Gelar Seni Pasar Kangen Yogyakarta",
                category: "kesenian",
                date: "2025-09-07",
                time: "10:00",
                location: "Yogyakarta",
                price: 0,
                description: "Pameran dan pertunjukan seni di Pasar Kangen Yogyakarta.",
                image: "img/kesenian5.jpg",
                capacity: 2000,
                trending: true
            },
            {
                id: 26,
                name: "Gelar Seni Rakyat (Jaranan Jawa Timur)",
                category: "kesenian",
                date: "2025-11-27",
                time: "19:00",
                location: "Surabaya",
                price: 0,
                description: "Pertunjukan seni rakyat Jaranan dari Jawa Timur.",
                image: "img/kesenian6.jpg",
                capacity: 1200,
                trending: false
            },
            {
                id: 27,
                name: "Surabaya Punya Wayang Orang",
                category: "kesenian",
                date: "2025-11-22",
                time: "19:30",
                location: "Surabaya",
                price: 0,
                description: "Pertunjukan wayang orang dengan lakon-lakon terkenal.",
                image: "img/kesenian7.jpg",
                capacity: 800,
                trending: true
            },
            {
                id: 28,
                name: "International Mask Festival (IMF) 2025",
                category: "kesenian",
                date: "2025-11-14",
                time: "10:00",
                location: "Jakarta",
                price: 0,
                description: "Festival topeng internasional dengan peserta dari berbagai negara.",
                image: "img/kesenian8.jpg",
                capacity: 3000,
                trending: true
            },
            {
                id: 29,
                name: "Malam Anugerah Sayembara Naskah Teater 2025",
                category: "kesenian",
                date: "2025-11-27",
                time: "19:00",
                location: "Jakarta",
                price: 0,
                description: "Malam penganugerahan sayembara naskah teater terbaik.",
                image: "img/kesenian9.jpg",
                capacity: 500,
                trending: false
            },
            {
                id: 30,
                name: "Festival Kesenian Rakyat Semilir",
                category: "kesenian",
                date: "2025-10-19",
                time: "18:00",
                location: "Semarang",
                price: 40000,
                description: "Festival kesenian rakyat dengan berbagai pertunjukan tradisional.",
                image: "img/kesenian10.jpg",
                capacity: 1500,
                trending: true
            },
            
            // Seminar events
            {
                id: 31,
                name: "Workshop Meta Ads 2024: Rahasia Dapat High Quality Leads",
                category: "seminar",
                date: "2024-08-02",
                time: "09:00",
                location: "Jakarta",
                price: 100000,
                description: "Workshop tentang strategi iklan Meta untuk mendapatkan leads berkualitas.",
                image: "img/seminar 8.jpg",
                capacity: 100,
                trending: false
            },
            {
                id: 32,
                name: "Polarisasi Musikal X BEM UNS (Screening & Talkshow)",
                category: "seminar",
                date: "2025-11-14",
                time: "13:00",
                location: "Solo",
                price: 850000,
                description: "Screening film dan talkshow tentang musik dan polarisasi.",
                image: "img/seminar 10.jpg",
                capacity: 200,
                trending: true
            },
            {
                id: 33,
                name: "Foundation Workshop Series: Management for Gen Z",
                category: "seminar",
                date: "2025-11-08",
                time: "09:00",
                location: "Jakarta",
                price: 400000,
                description: "Workshop manajemen khusus untuk Generasi Z.",
                image: "img/seminar 3.jpg",
                capacity: 150,
                trending: true
            },
            {
                id: 34,
                name: "Seminar Nasional Monetion 2024 (HEMa Manajemen FEB UMS)",
                category: "seminar",
                date: "2024-09-30",
                time: "08:00",
                location: "Surakarta",
                price: 20000,
                description: "Seminar nasional tentang moneter dan ekonomi.",
                image: "img/seminar 5.jpg",
                capacity: 300,
                trending: false
            },
            {
                id: 35,
                name: "Workshop Akuntax: Kesiapan Yayasan Menghadapi SPT Tahunan",
                category: "seminar",
                date: "2025-01-21",
                time: "09:00",
                location: "Jakarta",
                price: 250000,
                description: "Workshop persiapan SPT tahunan untuk yayasan.",
                image: "img/seminar 9.jpg",
                capacity: 100,
                trending: false
            },
            {
                id: 36,
                name: "TDA Club Jasa: Public Speaking for Entrepreneur and Leaders",
                category: "seminar",
                date: "2024-09-04",
                time: "18:00",
                location: "Bandung",
                price: 50000,
                description: "Workshop public speaking untuk entrepreneur dan pemimpin.",
                image: "img/seminar 6.jpg",
                capacity: 80,
                trending: true
            },
            {
                id: 37,
                name: "YOT Solo Workshop: Build a Great CV",
                category: "seminar",
                date: "2020-12-05",
                time: "09:00",
                location: "Solo",
                price: 10000,
                description: "Workshop pembuatan CV yang menarik untuk pencari kerja.",
                image: "img/seminar 4.jpg",
                capacity: 50,
                trending: false
            },
            {
                id: 38,
                name: "Healing & Growing: Bloom Where You Are",
                category: "seminar",
                date: "2025-12-13",
                time: "10:00",
                location: "Jakarta",
                price: 50000,
                description: "Seminar tentang kesehatan mental dan pengembangan diri.",
                image: "img/seminar 7.webp",
                capacity: 120,
                trending: true
            },
            {
                id: 39,
                name: "Belajar Bareng Tiktok Shop (Khusus Pemula)",
                category: "seminar",
                date: "2023-02-04",
                time: "14:00",
                location: "Online",
                price: 99000,
                description: "Workshop tentang cara berjualan di Tiktok Shop untuk pemula.",
                image: "img/seminar 1.jpg",
                capacity: 200,
                trending: false
            }
        ];

        // State management
        let state = {
            events: [],
            cart: [],
            orders: [],
            tickets: [],
            bookmarks: [],
            profile: {
                name: "Pengguna BAMStix",
                email: "pengguna@bamstix.id",
                phone: "081234567890",
                photo: "https://ui-avatars.com/api/?name=Pengguna&background=3A7BCE&color=fff"
            },
            settings: {
                theme: "default"
            },
            currentPage: "homePage",
            currentCategory: "all",
            currentEventId: null,
            currentTicketId: null,
            paymentTimer: null,
            paymentTimeLeft: 900 // 15 minutes in seconds
        };

        // DOM Elements
        const pages = document.querySelectorAll('.page');
        const iconItems = document.querySelectorAll('.icon-item');
        const loadingScreen = document.getElementById('loadingScreen');
        const toastContainer = document.getElementById('toastContainer');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const menuButton = document.getElementById('menuButton');
        const themeOptions = document.querySelectorAll('.theme-option');
        const cartBadge = document.getElementById('cartBadge');
        const profilePic = document.getElementById('profilePic');
        const profilePicture = document.getElementById('profilePicture');
        const profilePictureInput = document.getElementById('profilePictureInput');
        const changeProfilePicBtn = document.getElementById('changeProfilePicBtn');
        const eventsList = document.getElementById('eventsList');
        const categoryEventsList = document.getElementById('categoryEventsList');
        const eventDetailContent = document.getElementById('eventDetailContent');
        const cartItemsList = document.getElementById('cartItemsList');
        const cartTotal = document.getElementById('cartTotal');
        const checkoutTotal = document.getElementById('checkoutTotal');
        const orderSummary = document.getElementById('orderSummary');
        const paymentQrCode = document.getElementById('paymentQrCode');
        const countdownTimer = document.getElementById('countdownTimer');
        const ticketsList = document.getElementById('ticketsList');
        const ticketDetailContent = document.getElementById('ticketDetailContent');
        const bookmarksList = document.getElementById('bookmarksList');
        const mainSearch = document.getElementById('mainSearch');
        const searchButton = document.getElementById('searchButton');
        const sidebarSearch = document.getElementById('sidebarSearch');
        const filterOptions = document.querySelectorAll('.filter-option');
        const sortOptions = document.querySelectorAll('.sort-option');
        const tagFilters = document.querySelectorAll('.tag-filter');
        const ticketFilters = document.querySelectorAll('.ticket-filter');
        const imageModal = new bootstrap.Modal(document.getElementById('imageModal'));
        const modalImage = document.getElementById('modalImage');
        const purchaseHistoryContent = document.getElementById('purchaseHistoryContent');
        const noPurchaseHistory = document.getElementById('noPurchaseHistory');
        const viewAllHistoryBtn = document.getElementById('viewAllHistoryBtn');
        const navLinksSidebar = document.querySelectorAll('.nav-link-sidebar');

        // Initialize the application
        function init() {
            loadState();
            renderHomePage();
            setupEventListeners();
            initializeCarousel();
            updateCartBadge();
            renderPurchaseHistory();
            
            // Hide loading screen after a short delay
            setTimeout(() => {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }, 1000);
            
            // Check if service worker is supported
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('./service-worker.js')
                        .then(registration => {
                            console.log('Service Worker registered with scope:', registration.scope);
                        })
                        .catch(error => {
                            console.log('Service Worker registration failed:', error);
                        });
                });
            }
        }

        // Load state from localStorage
        function loadState() {
            const savedState = localStorage.getItem('bamstixState');
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                state = { ...state, ...parsedState };
                
                // Apply saved settings
                applyTheme();
            } else {
                // Initialize with default events
                state.events = [...initialEvents];
                saveState();
            }
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('bamstixState', JSON.stringify(state));
        }

        // Apply theme
        function applyTheme() {
            document.body.setAttribute('data-theme', state.settings.theme);
            
            // Update active theme indicator
            themeOptions.forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-theme') === state.settings.theme) {
                    option.classList.add('active');
                }
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            iconItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = item.getAttribute('data-page');
                    
                    // Update active icon
                    iconItems.forEach(icon => icon.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Handle category page
                    if (pageId === 'categoryPage') {
                        const category = item.getAttribute('data-category');
                        state.currentCategory = category;
                        showCategoryPage(category);
                    } else {
                        navigateTo(pageId);
                    }
                });
            });

            // Sidebar navigation links
            navLinksSidebar.forEach(link => {
                link.addEventListener('click', (e) => {
                    // If it's an external link (WhatsApp), let it open normally
                    if (link.hasAttribute('target')) {
                        return;
                    }
                    
                    e.preventDefault();
                    
                    // Close sidebar
                    closeSidebar();
                    
                    // Update active nav link
                    navLinksSidebar.forEach(navLink => navLink.classList.remove('active'));
                    link.classList.add('active');
                    
                    // Get page and category
                    const pageId = link.getAttribute('data-page');
                    const category = link.getAttribute('data-category');
                    
                    // Handle navigation
                    if (pageId === 'categoryPage' && category) {
                        state.currentCategory = category;
                        showCategoryPage(category);
                    } else if (pageId) {
                        navigateTo(pageId);
                    }
                });
            });

            // Sidebar
            menuButton.addEventListener('click', () => {
                openSidebar();
            });

            sidebarOverlay.addEventListener('click', () => {
                closeSidebar();
            });

            // Theme selection
            themeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    state.settings.theme = option.getAttribute('data-theme');
                    applyTheme();
                    saveState();
                });
            });

            // Profile picture change
            changeProfilePicBtn.addEventListener('click', () => {
                profilePictureInput.click();
            });

            profilePictureInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        state.profile.photo = event.target.result;
                        profilePic.src = state.profile.photo;
                        profilePicture.src = state.profile.photo;
                        saveState();
                        showToast('Foto profil berhasil diubah', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Back buttons
            document.querySelectorAll('[id^="backFrom"]').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    goBack();
                });
            });

            // Cart
            document.getElementById('cartButton').addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('cartPage');
            });

            document.getElementById('clearCartBtn').addEventListener('click', () => {
                if (state.cart.length > 0) {
                    if (confirm('Apakah Anda yakin ingin mengosongkan keranjang?')) {
                        state.cart = [];
                        updateCartBadge();
                        renderCartPage();
                        showToast('Keranjang berhasil dikosongkan', 'info');
                    }
                }
            });

            // Checkout
            document.getElementById('checkoutBtn').addEventListener('click', () => {
                if (state.cart.length === 0) {
                    showToast('Keranjang kosong', 'warning');
                    return;
                }
                navigateTo('checkoutPage');
                renderCheckoutPage();
            });

            document.getElementById('confirmPaymentBtn').addEventListener('click', () => {
                const fullName = document.getElementById('fullName').value;
                const email = document.getElementById('email').value;
                const phone = document.getElementById('phone').value;
                
                if (!fullName || !email || !phone) {
                    showToast('Harap lengkapi data diri', 'warning');
                    return;
                }
                
                // Update profile with checkout data
                state.profile.name = fullName;
                state.profile.email = email;
                state.profile.phone = phone;
                saveState();
                
                navigateTo('paymentQrPage');
                startPaymentTimer();
                generatePaymentQR();
            });

            // Payment
            document.getElementById('completePaymentBtn').addEventListener('click', () => {
                completePayment();
            });

            document.getElementById('cancelPaymentBtn').addEventListener('click', () => {
                if (confirm('Batalkan pembayaran?')) {
                    clearPaymentTimer();
                    navigateTo('cartPage');
                    showToast('Pembayaran dibatalkan', 'info');
                }
            });

            document.getElementById('viewTicketBtn').addEventListener('click', () => {
                // Navigate to the latest ticket
                if (state.tickets.length > 0) {
                    const latestTicket = state.tickets[state.tickets.length - 1];
                    state.currentTicketId = latestTicket.id;
                    navigateTo('ticketDetailPage');
                    renderTicketDetail(latestTicket.id);
                }
            });

            document.getElementById('backToHomeFromSuccess').addEventListener('click', () => {
                navigateTo('homePage');
            });

            // Profile
            document.getElementById('profileBtn').addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('profilePage');
                renderProfilePage();
            });

            document.getElementById('myTicketsBtn').addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('myTicketsPage');
                renderMyTicketsPage();
            });

            document.getElementById('bookmarksBtn').addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('bookmarksPage');
                renderBookmarksPage();
            });

            document.getElementById('saveProfileBtn').addEventListener('click', () => {
                const name = document.getElementById('profileFullName').value;
                const email = document.getElementById('profileEmailInput').value;
                const phone = document.getElementById('profilePhone').value;
                
                state.profile.name = name;
                state.profile.email = email;
                state.profile.phone = phone;
                
                saveState();
                showToast('Profil berhasil disimpan', 'success');
            });

            // Bookmarks
            document.getElementById('clearBookmarksBtn').addEventListener('click', () => {
                if (state.bookmarks.length > 0) {
                    if (confirm('Hapus semua bookmark?')) {
                        state.bookmarks = [];
                        saveState();
                        renderBookmarksPage();
                        showToast('Semua bookmark dihapus', 'info');
                    }
                }
            });

            document.getElementById('browseEventsFromBookmarks').addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('homePage');
            });

            document.getElementById('browseEventsFromTickets').addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('homePage');
            });

            // Search
            searchButton.addEventListener('click', performSearch);
            mainSearch.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            sidebarSearch.addEventListener('keyup', performSidebarSearch);

            // Filter and sort
            filterOptions.forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    const filter = option.getAttribute('data-filter');
                    filterEvents(filter);
                });
            });

            sortOptions.forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sort = option.getAttribute('data-sort');
                    sortEvents(sort);
                });
            });

            tagFilters.forEach(tag => {
                tag.addEventListener('click', () => {
                    const tagText = tag.getAttribute('data-tag');
                    mainSearch.value = tagText;
                    performSearch();
                });
            });

            ticketFilters.forEach(filter => {
                filter.addEventListener('click', (e) => {
                    e.preventDefault();
                    const status = filter.getAttribute('data-status');
                    filterTickets(status);
                });
            });

            // View all button
            document.getElementById('viewAllBtn').addEventListener('click', () => {
                state.currentCategory = 'all';
                showCategoryPage('all');
            });

            // View all history button
            viewAllHistoryBtn.addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('myTicketsPage');
            });

            // Image click for zoom
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('card-img-top') || 
                    e.target.classList.contains('event-detail-poster') ||
                    e.target.classList.contains('modal-image')) {
                    const imgSrc = e.target.getAttribute('src') || 
                                  e.target.getAttribute('data-src') ||
                                  'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80';
                    modalImage.src = imgSrc;
                    imageModal.show();
                }
            });

            // Payment method selection
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', () => {
                    // Unselect all
                    document.querySelectorAll('.payment-method').forEach(m => {
                        m.classList.remove('selected');
                    });
                    
                    // Select clicked
                    method.classList.add('selected');
                    
                    // Update radio button
                    const radio = method.querySelector('input[type="radio"]');
                    if (radio) radio.checked = true;
                });
            });
        }

        // Sidebar functions
        function openSidebar() {
            sidebar.classList.add('show');
            sidebarOverlay.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeSidebar() {
            sidebar.classList.remove('show');
            sidebarOverlay.classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        // Navigation functions
        function navigateTo(pageId) {
            // Show loading screen for page transitions
            loadingScreen.style.display = 'flex';
            loadingScreen.style.opacity = '1';
            
            setTimeout(() => {
                // Hide all pages
                pages.forEach(page => {
                    page.classList.remove('active');
                });
                
                // Show the requested page
                const page = document.getElementById(pageId);
                if (page) {
                    page.classList.add('active');
                    state.currentPage = pageId;
                    
                    // Scroll to top
                    window.scrollTo(0, 0);
                    
                    // Hide loading screen
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 300);
                }
            }, 300);
        }

        function goBack() {
            // Simple back navigation
            if (state.currentPage !== 'homePage') {
                navigateTo('homePage');
                
                // Update icon bar
                iconItems.forEach(icon => {
                    icon.classList.remove('active');
                    if (icon.getAttribute('data-page') === 'homePage') {
                        icon.classList.add('active');
                    }
                });
            }
        }

        // Render functions
        function renderHomePage() {
            // Clear events list
            eventsList.innerHTML = '';
            
            // Get events to display (limit to 6 for homepage)
            const eventsToShow = state.events.slice(0, 6);
            
            // Render each event
            eventsToShow.forEach(event => {
                const eventCard = createEventCard(event);
                eventsList.appendChild(eventCard);
            });
            
            // Update carousel
            initializeCarousel();
            
            // Update purchase history
            renderPurchaseHistory();
        }

        function showCategoryPage(category) {
            navigateTo('categoryPage');
            
            // Update category title
            const categoryTitle = document.getElementById('categoryTitle');
            let title = 'Semua Event';
            if (category !== 'all') {
                title = category.charAt(0).toUpperCase() + category.slice(1);
            }
            categoryTitle.textContent = title;
            
            // Render category events
            renderCategoryEvents(category);
        }

        function renderCategoryEvents(category) {
            // Clear category events list
            categoryEventsList.innerHTML = '';
            
            // Filter events by category
            let filteredEvents = state.events;
            if (category !== 'all') {
                filteredEvents = state.events.filter(event => event.category === category);
            }
            
            // Render each event
            filteredEvents.forEach(event => {
                const eventCard = createEventCard(event, true);
                categoryEventsList.appendChild(eventCard);
            });
            
            // If no events found
            if (filteredEvents.length === 0) {
                categoryEventsList.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-calendar-x" style="font-size: 3rem; color: #ccc;"></i>
                        <p class="mt-3">Tidak ada event ditemukan</p>
                    </div>
                `;
            }
        }

        function createEventCard(event, showCategory = false) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4 mb-4';
            
            // Format price
            const priceText = event.price === 0 ? 'GRATIS' : `Rp ${event.price.toLocaleString('id-ID')}`;
            
            // Check if event is bookmarked
            const isBookmarked = state.bookmarks.includes(event.id);
            
            // Get image URL or use default
            const imageUrl = event.image || `https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=${event.category}`;
            
            // Format date
            const eventDate = new Date(event.date);
            const formattedDate = eventDate.toLocaleDateString('id-ID', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            col.innerHTML = `
                <div class="card h-100">
                    <div class="position-relative">
                        <img src="${imageUrl}" class="card-img-top modal-image" alt="${event.name}" data-src="${imageUrl}">
                        <div class="event-category">${event.category.toUpperCase()}</div>
                        ${event.trending ? '<span class="badge badge-trending">TRENDING</span>' : ''}
                        <button class="bookmark-btn ${isBookmarked ? 'active' : ''}" data-event-id="${event.id}">
                            <i class="bi ${isBookmarked ? 'bi-bookmark-fill' : 'bi-bookmark'}"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <h5 class="event-title">${event.name}</h5>
                        <p class="small-text mb-2">
                            <i class="bi bi-calendar-event me-1"></i>${formattedDate} â€¢ ${event.time}
                        </p>
                        <p class="small-text mb-2">
                            <i class="bi bi-geo-alt me-1"></i>${event.location}
                        </p>
                        <p class="normal-text text-truncate">${event.description}</p>
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="price-tag">${priceText}</div>
                            <button class="btn btn-sm btn-primary buy-ticket-btn" data-event-id="${event.id}">
                                <i class="bi bi-ticket me-1"></i>Beli Tiket
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners to the buttons in this card
            col.querySelector('.buy-ticket-btn').addEventListener('click', () => {
                showEventDetail(event.id);
            });
            
            col.querySelector('.bookmark-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleBookmark(event.id);
            });
            
            return col;
        }

        function renderPurchaseHistory() {
            // Clear purchase history content
            purchaseHistoryContent.innerHTML = '';
            
            // Get latest purchase (most recent ticket)
            if (state.tickets.length > 0) {
                // Sort tickets by purchase date (newest first)
                const sortedTickets = [...state.tickets].sort((a, b) => 
                    new Date(b.purchaseDate) - new Date(a.purchaseDate)
                );
                
                const latestTicket = sortedTickets[0];
                const event = state.events.find(e => e.id === latestTicket.eventId);
                
                if (event) {
                    // Format date
                    const eventDate = new Date(latestTicket.eventDate);
                    const formattedDate = eventDate.toLocaleDateString('id-ID', {
                        day: 'numeric',
                        month: 'short',
                        year: 'numeric'
                    });
                    
                    // Determine status
                    let statusText = 'Aktif';
                    let statusClass = 'status-valid';
                    
                    if (latestTicket.status === 'used') {
                        statusText = 'Sudah Digunakan';
                    } else if (latestTicket.status === 'expired') {
                        statusText = 'Kadaluarsa';
                    } else if (latestTicket.status === 'resell') {
                        statusText = 'Untuk Dijual';
                    }
                    
                    // Check if event is expired
                    const now = new Date();
                    if (latestTicket.status === 'active' && eventDate < now) {
                        statusText = 'Kadaluarsa';
                        latestTicket.status = 'expired';
                        saveState();
                    }
                    
                    purchaseHistoryContent.innerHTML = `
                        <div class="purchase-history-content">
                            <div class="purchase-qr-placeholder">
                                <i class="bi bi-qr-code"></i>
                            </div>
                            <div class="purchase-details">
                                <h6 class="purchase-event-title">${latestTicket.eventName}</h6>
                                <div class="purchase-meta">
                                    <div class="purchase-meta-item">
                                        <i class="bi bi-calendar-event"></i>
                                        <span>${formattedDate} â€¢ ${latestTicket.eventTime}</span>
                                    </div>
                                    <div class="purchase-meta-item">
                                        <i class="bi bi-geo-alt"></i>
                                        <span>${latestTicket.eventLocation}</span>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="purchase-status">${statusText}</span>
                                    <button class="btn btn-sm btn-outline-primary view-ticket-history-btn" data-ticket-id="${latestTicket.id}">
                                        Lihat Tiket
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Add event listener to view ticket button
                    purchaseHistoryContent.querySelector('.view-ticket-history-btn').addEventListener('click', () => {
                        state.currentTicketId = latestTicket.id;
                        navigateTo('ticketDetailPage');
                        renderTicketDetail(latestTicket.id);
                    });
                    
                    noPurchaseHistory.style.display = 'none';
                } else {
                    noPurchaseHistory.style.display = 'block';
                }
            } else {
                noPurchaseHistory.style.display = 'block';
            }
        }

        function showEventDetail(eventId) {
            state.currentEventId = eventId;
            navigateTo('eventDetailPage');
            renderEventDetail(eventId);
        }

        function renderEventDetail(eventId) {
            const event = state.events.find(e => e.id === eventId);
            if (!event) {
                eventDetailContent.innerHTML = '<p>Event tidak ditemukan</p>';
                return;
            }
            
            // Format price
            const priceText = event.price === 0 ? 'GRATIS' : `Rp ${event.price.toLocaleString('id-ID')}`;
            
            // Get image URL or use default
            const imageUrl = event.image || `https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=${event.category}`;
            
            // Format date
            const eventDate = new Date(event.date);
            const formattedDate = eventDate.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Check if event is bookmarked
            const isBookmarked = state.bookmarks.includes(event.id);
            
            eventDetailContent.innerHTML = `
                <div class="card">
                    <div class="position-relative">
                        <img src="${imageUrl}" class="event-detail-poster modal-image" alt="${event.name}" data-src="${imageUrl}">
                        <button class="bookmark-btn ${isBookmarked ? 'active' : ''}" data-event-id="${event.id}" style="top: 20px; right: 20px;">
                            <i class="bi ${isBookmarked ? 'bi-bookmark-fill' : 'bi-bookmark'}"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <h4 class="event-title mb-3">${event.name}</h4>
                        
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-calendar-event me-2"></i>
                                    <div>
                                        <small class="text-muted">Tanggal</small>
                                        <p class="mb-0">${formattedDate}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-clock me-2"></i>
                                    <div>
                                        <small class="text-muted">Waktu</small>
                                        <p class="mb-0">${event.time}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-geo-alt me-2"></i>
                                    <div>
                                        <small class="text-muted">Lokasi</small>
                                        <p class="mb-0">${event.location}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h6 class="mb-2">Deskripsi Event</h6>
                        <p class="normal-text mb-4">${event.description}</p>
                        
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <small class="text-muted">Harga Tiket</small>
                                <h3 class="price-tag mb-0">${priceText}</h3>
                            </div>
                            <div class="d-flex align-items-center">
                                <button class="btn btn-outline-secondary me-2" id="decreaseTicket">
                                    <i class="bi bi-dash"></i>
                                </button>
                                <span id="ticketQuantity" class="mx-2" style="font-size: 1.2rem;">1</span>
                                <button class="btn btn-outline-secondary me-3" id="increaseTicket">
                                    <i class="bi bi-plus"></i>
                                </button>
                                <button class="btn btn-primary" id="addToCartBtn">
                                    <i class="bi bi-cart-plus me-2"></i>Tambah ke Keranjang
                                </button>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 mt-4">
                            <button class="btn btn-success btn-lg" id="buyNowBtn">
                                <i class="bi bi-credit-card me-2"></i>Beli Sekarang
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners
            eventDetailContent.querySelector('.bookmark-btn').addEventListener('click', () => {
                toggleBookmark(event.id);
                renderEventDetail(eventId); // Re-render to update bookmark button
            });
            
            let ticketQuantity = 1;
            const ticketQuantityElement = document.getElementById('ticketQuantity');
            
            document.getElementById('increaseTicket').addEventListener('click', () => {
                ticketQuantity++;
                ticketQuantityElement.textContent = ticketQuantity;
            });
            
            document.getElementById('decreaseTicket').addEventListener('click', () => {
                if (ticketQuantity > 1) {
                    ticketQuantity--;
                    ticketQuantityElement.textContent = ticketQuantity;
                }
            });
            
            document.getElementById('addToCartBtn').addEventListener('click', () => {
                addToCart(event.id, ticketQuantity);
            });
            
            document.getElementById('buyNowBtn').addEventListener('click', () => {
                addToCart(event.id, ticketQuantity);
                navigateTo('cartPage');
                renderCartPage();
            });
        }

        function addToCart(eventId, quantity = 1) {
            const event = state.events.find(e => e.id === eventId);
            if (!event) return;
            
            // Check if event is already in cart
            const existingItemIndex = state.cart.findIndex(item => item.eventId === eventId);
            
            if (existingItemIndex >= 0) {
                // Update quantity
                state.cart[existingItemIndex].quantity += quantity;
            } else {
                // Add new item
                state.cart.push({
                    eventId,
                    quantity,
                    price: event.price,
                    name: event.name,
                    date: event.date,
                    location: event.location,
                    category: event.category
                });
            }
            
            saveState();
            updateCartBadge();
            showToast(`${quantity} tiket "${event.name}" ditambahkan ke keranjang`, 'success');
        }

        function renderCartPage() {
            // Clear cart items list
            cartItemsList.innerHTML = '';
            
            if (state.cart.length === 0) {
                cartItemsList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-cart" style="font-size: 3rem; color: #ccc;"></i>
                        <p class="mt-3">Keranjang Anda kosong</p>
                        <a href="#" class="btn btn-primary" id="browseEventsFromCart">Jelajahi Event</a>
                    </div>
                `;
                
                document.getElementById('browseEventsFromCart').addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo('homePage');
                });
                
                cartTotal.textContent = 'Rp 0';
                return;
            }
            
            // Render each cart item
            let total = 0;
            
            state.cart.forEach((item, index) => {
                const event = state.events.find(e => e.id === item.eventId);
                if (!event) return;
                
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div>
                        <h6 class="mb-1">${item.name}</h6>
                        <p class="small-text mb-0">${item.category} â€¢ ${item.location}</p>
                        <p class="price-tag mb-0">Rp ${itemTotal.toLocaleString('id-ID')}</p>
                    </div>
                    <div class="cart-item-controls">
                        <button class="btn btn-sm btn-outline-secondary" data-index="${index}" data-action="decrease">
                            <i class="bi bi-dash"></i>
                        </button>
                        <span>${item.quantity}</span>
                        <button class="btn btn-sm btn-outline-secondary" data-index="${index}" data-action="increase">
                            <i class="bi bi-plus"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger ms-2" data-index="${index}" data-action="remove">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                `;
                
                cartItemsList.appendChild(cartItem);
            });
            
            // Update total
            cartTotal.textContent = `Rp ${total.toLocaleString('id-ID')}`;
            
            // Add event listeners to cart controls
            cartItemsList.querySelectorAll('[data-index]').forEach(button => {
                button.addEventListener('click', () => {
                    const index = parseInt(button.getAttribute('data-index'));
                    const action = button.getAttribute('data-action');
                    
                    handleCartAction(index, action);
                });
            });
        }

        function handleCartAction(index, action) {
            if (index < 0 || index >= state.cart.length) return;
            
            const item = state.cart[index];
            const event = state.events.find(e => e.id === item.eventId);
            
            switch (action) {
                case 'increase':
                    item.quantity++;
                    showToast(`Menambah tiket "${event.name}"`, 'info');
                    break;
                case 'decrease':
                    if (item.quantity > 1) {
                        item.quantity--;
                        showToast(`Mengurangi tiket "${event.name}"`, 'info');
                    } else {
                        // Remove item if quantity becomes 0
                        state.cart.splice(index, 1);
                        showToast(`Menghapus "${event.name}" dari keranjang`, 'info');
                    }
                    break;
                case 'remove':
                    state.cart.splice(index, 1);
                    showToast(`Menghapus "${event.name}" dari keranjang`, 'info');
                    break;
            }
            
            saveState();
            updateCartBadge();
            renderCartPage();
        }

        function updateCartBadge() {
            const totalItems = state.cart.reduce((sum, item) => sum + item.quantity, 0);
            cartBadge.textContent = totalItems;
            cartBadge.style.display = totalItems > 0 ? 'flex' : 'none';
        }

        function renderCheckoutPage() {
            // Update order summary
            let total = 0;
            let summaryHTML = '';
            
            state.cart.forEach(item => {
                const event = state.events.find(e => e.id === item.eventId);
                if (!event) return;
                
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                summaryHTML += `
                    <div class="d-flex justify-content-between mb-2">
                        <div>
                            <p class="mb-0">${item.name} <small class="text-muted">x${item.quantity}</small></p>
                        </div>
                        <div>Rp ${itemTotal.toLocaleString('id-ID')}</div>
                    </div>
                `;
            });
            
            orderSummary.innerHTML = summaryHTML;
            checkoutTotal.textContent = `Rp ${total.toLocaleString('id-ID')}`;
            
            // Pre-fill form with profile data
            document.getElementById('fullName').value = state.profile.name;
            document.getElementById('email').value = state.profile.email;
            document.getElementById('phone').value = state.profile.phone;
        }

        function startPaymentTimer() {
            // Clear any existing timer
            clearPaymentTimer();
            
            state.paymentTimeLeft = 900; // 15 minutes
            
            // Update timer immediately
            updateTimerDisplay();
            
            // Start countdown
            state.paymentTimer = setInterval(() => {
                state.paymentTimeLeft--;
                updateTimerDisplay();
                
                if (state.paymentTimeLeft <= 0) {
                    clearPaymentTimer();
                    showToast('Waktu pembayaran habis', 'warning');
                    navigateTo('cartPage');
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(state.paymentTimeLeft / 60);
            const seconds = state.paymentTimeLeft % 60;
            countdownTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running out
            if (state.paymentTimeLeft < 300) { // Less than 5 minutes
                countdownTimer.style.color = 'var(--danger)';
            } else if (state.paymentTimeLeft < 600) { // Less than 10 minutes
                countdownTimer.style.color = 'var(--warning)';
            }
        }

        function clearPaymentTimer() {
            if (state.paymentTimer) {
                clearInterval(state.paymentTimer);
                state.paymentTimer = null;
            }
        }

        function generatePaymentQR() {
            // Clear previous QR
            paymentQrCode.innerHTML = '';
            
            // Generate a random order ID
            const orderId = 'BAM-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
            
            // Create QR data
            const qrData = JSON.stringify({
                orderId,
                amount: state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                timestamp: new Date().toISOString(),
                merchant: 'BAMStix.id'
            });
            
            // Generate QR code
            new QRCode(paymentQrCode, {
                text: qrData,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        function completePayment() {
            clearPaymentTimer();
            
            // Create order
            const orderId = 'ORD-' + Date.now();
            const orderTotal = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            const order = {
                id: orderId,
                date: new Date().toISOString(),
                items: [...state.cart],
                total: orderTotal,
                status: 'success'
            };
            
            // Add to orders
            state.orders.push(order);
            
            // Create tickets for each cart item
            state.cart.forEach(cartItem => {
                const event = state.events.find(e => e.id === cartItem.eventId);
                if (!event) return;
                
                for (let i = 0; i < cartItem.quantity; i++) {
                    const ticketId = 'TKT-' + Date.now() + '-' + Math.floor(Math.random() * 10000);
                    
                    const ticket = {
                        id: ticketId,
                        orderId,
                        eventId: cartItem.eventId,
                        eventName: cartItem.name,
                        eventDate: cartItem.date,
                        eventTime: event.time,
                        eventLocation: cartItem.location,
                        purchaseDate: new Date().toISOString(),
                        price: cartItem.price,
                        status: 'active', // active, used, expired, resell
                        qrData: JSON.stringify({
                            ticketId,
                            eventId: cartItem.eventId,
                            purchaseDate: new Date().toISOString()
                        })
                    };
                    
                    state.tickets.push(ticket);
                }
            });
            
            // Clear cart
            state.cart = [];
            
            // Save state
            saveState();
            updateCartBadge();
            
            // Navigate to success page
            navigateTo('paymentSuccessPage');
            
            // Generate success QR code
            const successQrCode = document.querySelector('#paymentSuccessPage .qr-code');
            successQrCode.innerHTML = '';
            
            // Use the first ticket's QR data
            if (state.tickets.length > 0) {
                const firstTicket = state.tickets.find(t => t.orderId === orderId);
                if (firstTicket) {
                    new QRCode(successQrCode, {
                        text: firstTicket.qrData,
                        width: 180,
                        height: 180,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                }
            }
            
            showToast('Pembayaran berhasil! Tiket telah ditambahkan ke akun Anda.', 'success');
            
            // Update purchase history after successful payment
            renderPurchaseHistory();
        }

        function renderMyTicketsPage() {
            ticketsList.innerHTML = '';
            
            if (state.tickets.length === 0) {
                document.getElementById('noTicketsMessage').style.display = 'block';
                return;
            }
            
            document.getElementById('noTicketsMessage').style.display = 'none';
            
            // Show all tickets by default
            const filteredTickets = state.tickets;
            
            filteredTickets.forEach(ticket => {
                const event = state.events.find(e => e.id === ticket.eventId);
                if (!event) return;
                
                const ticketCard = createTicketCard(ticket, event);
                ticketsList.appendChild(ticketCard);
            });
        }

        function createTicketCard(ticket, event) {
            const card = document.createElement('div');
            card.className = 'card ticket-card mb-3';
            
            // Format dates
            const eventDate = new Date(ticket.eventDate);
            const purchaseDate = new Date(ticket.purchaseDate);
            const formattedEventDate = eventDate.toLocaleDateString('id-ID', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            const formattedPurchaseDate = purchaseDate.toLocaleDateString('id-ID');
            
            // Status badge
            let statusText = 'Aktif';
            let statusClass = 'status-valid';
            
            if (ticket.status === 'used') {
                statusText = 'Sudah Digunakan';
                statusClass = 'status-used';
            } else if (ticket.status === 'expired') {
                statusText = 'Kadaluarsa';
                statusClass = 'status-used';
            } else if (ticket.status === 'resell') {
                statusText = 'Untuk Dijual';
                statusClass = 'status-pending';
            }
            
            // Check if event is expired
            const now = new Date();
            if (ticket.status === 'active' && eventDate < now) {
                statusText = 'Kadaluarsa';
                statusClass = 'status-used';
                ticket.status = 'expired';
            }
            
            // Get image URL or use default
            const imageUrl = event.image || `https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=${event.category}`;
            
            card.innerHTML = `
                <div class="card-body">
                    <div class="row">
                        <div class="col-3">
                            <img src="${imageUrl}" class="img-fluid rounded modal-image" alt="${ticket.eventName}" style="height: 80px; object-fit: cover;">
                        </div>
                        <div class="col-9">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1">${ticket.eventName}</h6>
                                    <p class="small-text mb-1">
                                        <i class="bi bi-calendar-event me-1"></i>${formattedEventDate} â€¢ ${ticket.eventTime}
                                    </p>
                                    <p class="small-text mb-2">
                                        <i class="bi bi-geo-alt me-1"></i>${ticket.eventLocation}
                                    </p>
                                </div>
                                <span class="ticket-status ${statusClass}">${statusText}</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">ID: ${ticket.id}</small>
                                <button class="btn btn-sm btn-outline-primary view-ticket-btn" data-ticket-id="${ticket.id}">
                                    Lihat Tiket
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listener
            card.querySelector('.view-ticket-btn').addEventListener('click', () => {
                state.currentTicketId = ticket.id;
                navigateTo('ticketDetailPage');
                renderTicketDetail(ticket.id);
            });
            
            return card;
        }

        function renderTicketDetail(ticketId) {
            const ticket = state.tickets.find(t => t.id === ticketId);
            if (!ticket) {
                ticketDetailContent.innerHTML = '<p>Tiket tidak ditemukan</p>';
                return;
            }
            
            const event = state.events.find(e => e.id === ticket.eventId);
            if (!event) {
                ticketDetailContent.innerHTML = '<p>Event tidak ditemukan</p>';
                return;
            }
            
            // Format dates
            const eventDate = new Date(ticket.eventDate);
            const purchaseDate = new Date(ticket.purchaseDate);
            const formattedEventDate = eventDate.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            const formattedPurchaseDate = purchaseDate.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Status
            let statusText = 'Aktif';
            let statusClass = 'status-valid';
            
            if (ticket.status === 'used') {
                statusText = 'Sudah Digunakan';
                statusClass = 'status-used';
            } else if (ticket.status === 'expired') {
                statusText = 'Kadaluarsa';
                statusClass = 'status-used';
            } else if (ticket.status === 'resell') {
                statusText = 'Untuk Dijual';
                statusClass = 'status-pending';
            }
            
            // Check if event is expired
            const now = new Date();
            if (ticket.status === 'active' && eventDate < now) {
                statusText = 'Kadaluarsa';
                statusClass = 'status-used';
                ticket.status = 'expired';
                saveState();
            }
            
            // Get image URL or use default
            const imageUrl = event.image || `https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=${event.category}`;
            
            ticketDetailContent.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <div class="qr-code ${ticket.status === 'used' ? 'ticket-used' : ''}" id="ticketQrCode">
                                <!-- QR Code will be generated here -->
                            </div>
                            <p class="mt-2">Tunjukkan QR Code ini di lokasi event</p>
                            <span class="ticket-status ${statusClass}">${statusText}</span>
                        </div>
                        
                        <div class="mb-4">
                            <img src="${imageUrl}" class="img-fluid rounded modal-image" alt="${ticket.eventName}" style="height: 150px; width: 100%; object-fit: cover;">
                        </div>
                        
                        <h4 class="event-title mb-3">${ticket.eventName}</h4>
                        
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-calendar-event me-2"></i>
                                    <div>
                                        <small class="text-muted">Tanggal Event</small>
                                        <p class="mb-0">${formattedEventDate}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-clock me-2"></i>
                                    <div>
                                        <small class="text-muted">Waktu Event</small>
                                        <p class="mb-0">${ticket.eventTime}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-geo-alt me-2"></i>
                                    <div>
                                        <small class="text-muted">Lokasi Event</small>
                                        <p class="mb-0">${ticket.eventLocation}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-ticket me-2"></i>
                                    <div>
                                        <small class="text-muted">ID Tiket</small>
                                        <p class="mb-0">${ticket.id}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-currency-exchange me-2"></i>
                                    <div>
                                        <small class="text-muted">Harga</small>
                                        <p class="mb-0">Rp ${ticket.price.toLocaleString('id-ID')}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-calendar-check me-2"></i>
                                    <div>
                                        <small class="text-muted">Tanggal Pembelian</small>
                                        <p class="mb-0">${formattedPurchaseDate}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 mt-4">
                            ${ticket.status === 'active' ? `
                                <button class="btn btn-outline-warning" id="resellTicketBtn">
                                    <i class="bi bi-arrow-repeat me-1"></i>Jual Tiket Ini
                                </button>
                            ` : ''}
                            
                            ${ticket.status === 'resell' ? `
                                <button class="btn btn-outline-secondary" id="cancelResellBtn">
                                    <i class="bi bi-x-circle me-1"></i>Batalkan Penjualan
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            // Generate QR code
            const qrContainer = document.getElementById('ticketQrCode');
            qrContainer.innerHTML = '';
            
            new QRCode(qrContainer, {
                text: ticket.qrData,
                width: 200,
                height: 200,
                colorDark: ticket.status === 'used' ? '#cccccc' : '#000000',
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            // Add event listeners for ticket actions
            if (ticket.status === 'active') {
                document.getElementById('resellTicketBtn').addEventListener('click', () => {
                    if (confirm('Jual tiket ini? Tiket akan ditandai sebagai untuk dijual.')) {
                        ticket.status = 'resell';
                        saveState();
                        renderTicketDetail(ticketId);
                        showToast('Tiket ditandai untuk dijual', 'success');
                    }
                });
            }
            
            if (ticket.status === 'resell') {
                document.getElementById('cancelResellBtn').addEventListener('click', () => {
                    ticket.status = 'active';
                    saveState();
                    renderTicketDetail(ticketId);
                    showToast('Penjualan tiket dibatalkan', 'info');
                });
            }
        }

        function renderProfilePage() {
            // Update profile info
            document.getElementById('profileName').textContent = state.profile.name;
            document.getElementById('profileEmail').textContent = state.profile.email;
            document.getElementById('profileFullName').value = state.profile.name;
            document.getElementById('profileEmailInput').value = state.profile.email;
            document.getElementById('profilePhone').value = state.profile.phone;
            profilePicture.src = state.profile.photo;
            
            // Update statistics
            const totalTickets = state.tickets.length;
            const activeTickets = state.tickets.filter(t => t.status === 'active').length;
            const bookmarkedEvents = state.bookmarks.length;
            
            document.getElementById('totalTickets').textContent = totalTickets;
            document.getElementById('activeTickets').textContent = activeTickets;
            document.getElementById('bookmarkedEvents').textContent = bookmarkedEvents;
        }

        function renderBookmarksPage() {
            bookmarksList.innerHTML = '';
            
            if (state.bookmarks.length === 0) {
                document.getElementById('noBookmarksMessage').style.display = 'block';
                return;
            }
            
            document.getElementById('noBookmarksMessage').style.display = 'none';
            
            // Get bookmarked events
            const bookmarkedEvents = state.events.filter(event => 
                state.bookmarks.includes(event.id)
            );
            
            // Render bookmarked events
            bookmarkedEvents.forEach(event => {
                const eventCard = createEventCard(event, true);
                bookmarksList.appendChild(eventCard);
            });
        }

        function toggleBookmark(eventId) {
            const index = state.bookmarks.indexOf(eventId);
            
            if (index >= 0) {
                // Remove bookmark
                state.bookmarks.splice(index, 1);
                showToast('Event dihapus dari bookmark', 'info');
            } else {
                // Add bookmark
                state.bookmarks.push(eventId);
                showToast('Event ditambahkan ke bookmark', 'success');
            }
            
            saveState();
        }

        function performSearch() {
            const query = mainSearch.value.toLowerCase().trim();
            
            if (!query) {
                renderHomePage();
                return;
            }
            
            // Filter events based on search query
            const filteredEvents = state.events.filter(event => 
                event.name.toLowerCase().includes(query) ||
                event.category.toLowerCase().includes(query) ||
                event.location.toLowerCase().includes(query) ||
                event.description.toLowerCase().includes(query)
            );
            
            // Update events list with search results
            eventsList.innerHTML = '';
            
            if (filteredEvents.length === 0) {
                eventsList.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-search" style="font-size: 3rem; color: #ccc;"></i>
                        <p class="mt-3">Tidak ada event ditemukan untuk "${query}"</p>
                    </div>
                `;
            } else {
                filteredEvents.forEach(event => {
                    const eventCard = createEventCard(event);
                    eventsList.appendChild(eventCard);
                });
            }
            
            showToast(`Ditemukan ${filteredEvents.length} event untuk "${query}"`, 'info');
        }

        function performSidebarSearch() {
            const query = sidebarSearch.value.toLowerCase().trim();
            const searchResultsList = document.getElementById('searchResultsList');
            const sidebarSearchResults = document.getElementById('sidebarSearchResults');
            
            if (!query) {
                sidebarSearchResults.style.display = 'none';
                return;
            }
            
            // Filter events based on search query
            const filteredEvents = state.events.filter(event => 
                event.name.toLowerCase().includes(query) ||
                event.category.toLowerCase().includes(query) ||
                event.location.toLowerCase().includes(query)
            ).slice(0, 5); // Limit to 5 results
            
            // Update search results
            searchResultsList.innerHTML = '';
            
            if (filteredEvents.length === 0) {
                searchResultsList.innerHTML = `
                    <div class="list-group-item">
                        <p class="mb-0 text-muted">Tidak ada event ditemukan</p>
                    </div>
                `;
            } else {
                filteredEvents.forEach(event => {
                    const listItem = document.createElement('a');
                    listItem.href = '#';
                    listItem.className = 'list-group-item list-group-item-action';
                    listItem.innerHTML = `
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="mb-1">${event.name}</h6>
                                <small class="text-muted">${event.category} â€¢ ${event.location}</small>
                            </div>
                            <small class="text-primary">${event.price === 0 ? 'GRATIS' : `Rp ${event.price.toLocaleString('id-ID')}`}</small>
                        </div>
                    `;
                    
                    listItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        closeSidebar();
                        showEventDetail(event.id);
                    });
                    
                    searchResultsList.appendChild(listItem);
                });
            }
            
            sidebarSearchResults.style.display = 'block';
        }

        function filterEvents(filter) {
            // Update UI to show active filter
            const filterDropdown = document.getElementById('filterDropdown');
            let filterText = 'Semua';
            
            if (filter !== 'all') {
                filterText = filter.charAt(0).toUpperCase() + filter.slice(1);
            }
            
            filterDropdown.innerHTML = `<i class="bi bi-funnel me-1"></i> ${filterText}`;
            
            // Filter events
            let filteredEvents = state.events;
            if (filter !== 'all') {
                filteredEvents = state.events.filter(event => event.category === filter);
            }
            
            // Update events list
            eventsList.innerHTML = '';
            
            if (filteredEvents.length === 0) {
                eventsList.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-calendar-x" style="font-size: 3rem; color: #ccc;"></i>
                        <p class="mt-3">Tidak ada event ditemukan</p>
                    </div>
                `;
            } else {
                filteredEvents.forEach(event => {
                    const eventCard = createEventCard(event);
                    eventsList.appendChild(eventCard);
                });
            }
            
            showToast(`Menampilkan ${filteredEvents.length} event ${filter !== 'all' ? `dari kategori ${filterText}` : ''}`, 'info');
        }

        function sortEvents(sortType) {
            // Update UI to show active sort
            const sortDropdown = document.getElementById('sortDropdown');
            let sortText = 'Urutkan';
            
            const eventsCopy = [...state.events];
            
            switch (sortType) {
                case 'date-asc':
                    sortText = 'Tanggal Terdekat';
                    eventsCopy.sort((a, b) => new Date(a.date) - new Date(b.date));
                    break;
                case 'price-asc':
                    sortText = 'Harga Termurah';
                    eventsCopy.sort((a, b) => a.price - b.price);
                    break;
                case 'price-desc':
                    sortText = 'Harga Termahal';
                    eventsCopy.sort((a, b) => b.price - a.price);
                    break;
                case 'popular':
                    sortText = 'Paling Populer';
                    // For demo, sort by trending flag
                    eventsCopy.sort((a, b) => (b.trending ? 1 : 0) - (a.trending ? 1 : 0));
                    break;
            }
            
            sortDropdown.innerHTML = `<i class="bi bi-sort-down me-1"></i> ${sortText}`;
            
            // Update events list
            eventsList.innerHTML = '';
            eventsCopy.forEach(event => {
                const eventCard = createEventCard(event);
                eventsList.appendChild(eventCard);
            });
            
            showToast(`Event diurutkan berdasarkan ${sortText.toLowerCase()}`, 'info');
        }

        function filterTickets(status) {
            // Update UI to show active filter
            const ticketFilterDropdown = document.getElementById('ticketFilterDropdown');
            let filterText = 'Semua Tiket';
            
            let filteredTickets = state.tickets;
            
            if (status !== 'all') {
                filteredTickets = state.tickets.filter(ticket => ticket.status === status);
                
                switch (status) {
                    case 'active':
                        filterText = 'Tiket Aktif';
                        break;
                    case 'used':
                        filterText = 'Sudah Digunakan';
                        break;
                    case 'expired':
                        filterText = 'Kadaluarsa';
                        break;
                    case 'resell':
                        filterText = 'Untuk Dijual';
                        break;
                }
            }
            
            ticketFilterDropdown.textContent = filterText;
            
            // Update tickets list
            ticketsList.innerHTML = '';
            
            if (filteredTickets.length === 0) {
                ticketsList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-ticket" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <p>Tidak ada tiket ${status !== 'all' ? `dengan status ${filterText.toLowerCase()}` : ''}</p>
                    </div>
                `;
            } else {
                filteredTickets.forEach(ticket => {
                    const event = state.events.find(e => e.id === ticket.eventId);
                    if (!event) return;
                    
                    const ticketCard = createTicketCard(ticket, event);
                    ticketsList.appendChild(ticketCard);
                });
            }
        }

        function initializeCarousel() {
            const carouselInner = document.querySelector('#eventCarousel .carousel-inner');
            
            // Clear existing carousel items
            carouselInner.innerHTML = '';
            
            // Get trending events (or first 4 events if no trending)
            const trendingEvents = state.events.filter(event => event.trending).slice(0, 4);
            const eventsToShow = trendingEvents.length >= 4 ? trendingEvents : state.events.slice(0, 4);
            
            // Create carousel items
            eventsToShow.forEach((event, index) => {
                // Get image URL or use default
                const imageUrl = event.image || `https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=${event.category}`;
                
                const carouselItem = document.createElement('div');
                carouselItem.className = `carousel-item ${index === 0 ? 'active' : ''}`;
                carouselItem.innerHTML = `
                    <img src="${imageUrl}" class="d-block w-100" alt="${event.name}">
                    <div class="carousel-caption d-none d-md-block" style="background: rgba(0,0,0,0.5); border-radius: 10px; padding: 10px;">
                        <h5>${event.name}</h5>
                        <p>${event.date} â€¢ ${event.location}</p>
                    </div>
                `;
                
                // Add click event to navigate to event detail
                carouselItem.addEventListener('click', () => {
                    showEventDetail(event.id);
                });
                
                carouselInner.appendChild(carouselItem);
            });
            
            // Initialize carousel auto-slide
            const carousel = new bootstrap.Carousel(document.getElementById('eventCarousel'), {
                interval: 3000,
                ride: 'carousel'
            });
        }

        function showToast(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.setAttribute('role', 'alert');
            toast.innerHTML = `
                <div class="toast-body d-flex justify-content-between align-items-center">
                    <span>${message}</span>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            // Add to container
            toastContainer.appendChild(toast);
            
            // Initialize Bootstrap toast
            const bsToast = new bootstrap.Toast(toast, {
                autohide: true,
                delay: 2000
            });
            
            // Show toast
            bsToast.show();
            
            // Remove from DOM after hiding
            toast.addEventListener('hidden.bs.toast', () => {
                toast.remove();
            });
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
